# ğŸ“œ æœ‰å‘å›¾ç¯æ£€æµ‹ï¼šBFS (Kahn) ä¸ DFS (ä¸‰è‰²) æ–¹æ³•è¯¦è§£

åœ¨æœ‰å‘å›¾ä¸­ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨ç¯æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é—®é¢˜ã€‚å®ƒä¸ä»…æ˜¯æ‹“æ‰‘æ’åºï¼ˆå¦‚ LeetCode 207 è¯¾ç¨‹è¡¨ï¼‰çš„æ ¸å¿ƒï¼Œä¹Ÿåœ¨æ£€æµ‹ä¾èµ–é¡¹ï¼ˆå¦‚ç¼–è¯‘é¡ºåºã€æ•°æ®åº“äº‹åŠ¡ï¼‰ä¸­æ‰®æ¼”å…³é”®è§’è‰²ã€‚

æœ¬æ–‡æ¡£å°†è¯¦ç»†ä»‹ç»å¹¶å¯¹æ¯”ä¸¤ç§æœ€ä¸»æµçš„åˆ¤ç¯æ–¹æ³•ï¼š

1. **åŸºäº BFS çš„ Kahn ç®—æ³•** (Kahn's Algorithm)
2. **åŸºäº DFS çš„ä¸‰è‰²æ ‡è®°æ³•** (Three-Color Mark)

## 1. ğŸ¥‡ æ–¹æ³•ä¸€ï¼šBFS (Kahn ç®—æ³•) ä¸å…¥åº¦åˆ¤ç¯

Kahn ç®—æ³•æ˜¯å®ç°æ‹“æ‰‘æ’åºçš„æ ‡å‡†ç®—æ³•ä¹‹ä¸€ã€‚å®ƒåˆ¤ç¯çš„é€»è¾‘éå¸¸å·§å¦™ï¼šå®ƒ**å¹¶ä¸**æ˜¯ä¸»åŠ¨å»æ‰¾ç¯ï¼Œè€Œæ˜¯é€šè¿‡**æ£€æŸ¥æ‹“æ‰‘æ’åºèƒ½å¦æˆåŠŸå®Œæˆ**æ¥â€œåè¯â€å›¾ä¸­æœ‰ç¯ã€‚

### æ ¸å¿ƒæ€æƒ³

- **æ‹“æ‰‘æ’åº**ï¼šä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ (DAG) å¿…å®šè‡³å°‘å­˜åœ¨ä¸€ä¸ªå…¥åº¦ (In-degree) ä¸º 0 çš„èŠ‚ç‚¹ã€‚
- **Kahn ç®—æ³•æµç¨‹**ï¼š
  1. ä»æ‰€æœ‰å…¥åº¦ä¸º 0 çš„èŠ‚ç‚¹å¼€å§‹ã€‚
  2. å°†å®ƒä»¬â€œè¾“å‡ºâ€åˆ°æ‹“æ‰‘åºåˆ—ä¸­ï¼ˆå³å…¥é˜Ÿå†å‡ºé˜Ÿï¼‰ã€‚
  3. â€œåˆ é™¤â€è¿™äº›èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å‡ºè¾¹ï¼Œè¿™è¡¨ç°ä¸ºå°†å®ƒä»¬æŒ‡å‘çš„é‚»å±…èŠ‚ç‚¹çš„å…¥åº¦å‡ 1ã€‚
  4. å¦‚æœæŸä¸ªé‚»å±…èŠ‚ç‚¹åœ¨å…¥åº¦å‡ 1 åå˜ä¸º 0ï¼Œåˆ™å®ƒæˆä¸ºæ–°çš„â€œèµ·ç‚¹â€ï¼Œå°†å…¶å…¥é˜Ÿã€‚
  5. é‡å¤æ­¤è¿‡ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºã€‚
- **åˆ¤ç¯åŸç†**ï¼š
  - å¦‚æœä¸€ä¸ªå›¾**æ— ç¯**ï¼Œä¸Šè¿°è¿‡ç¨‹å°†èƒ½é¡ºåˆ©åœ°â€œå‰¥â€å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œ**æœ€ç»ˆå…¥é˜Ÿçš„èŠ‚ç‚¹æ€»æ•° `count` ä¼šç­‰äºå›¾çš„æ€»èŠ‚ç‚¹æ•° `n`**ã€‚
  - å¦‚æœä¸€ä¸ªå›¾**æœ‰ç¯**ï¼ˆä¾‹å¦‚ `A -> B -> C -> A`ï¼‰ï¼Œç¯ä¸Šæ‰€æœ‰èŠ‚ç‚¹ï¼ˆA, B, Cï¼‰çš„å…¥åº¦**æ°¸è¿œæ— æ³•é™ä¸º 0**ï¼ˆA ç­‰å¾… Cï¼ŒC ç­‰å¾… Bï¼ŒB ç­‰å¾… Aï¼‰ã€‚å› æ­¤ï¼Œå®ƒä»¬**æ°¸è¿œä¸ä¼šå…¥é˜Ÿ**ã€‚
  - è¿™å°†å¯¼è‡´**æœ€ç»ˆå…¥é˜Ÿçš„èŠ‚ç‚¹æ€»æ•° `count` å¿…å®šå°äºæ€»èŠ‚ç‚¹æ•° `n`**ã€‚

### ç®—æ³•æ­¥éª¤

1. **åˆå§‹åŒ–**ï¼š
   - åˆ›å»ºä¸€ä¸ªé‚»æ¥è¡¨ `adj`ã€‚
   - åˆ›å»ºä¸€ä¸ªå…¥åº¦æ•°ç»„ `in_degree[n]`ï¼Œç»Ÿè®¡æ‰€æœ‰èŠ‚ç‚¹çš„å…¥åº¦ã€‚
2. **å‡†å¤‡ BFS**ï¼š
   - åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ— `queue`ã€‚
   - å°†æ‰€æœ‰ `in_degree[i] == 0` çš„èŠ‚ç‚¹å…¥é˜Ÿã€‚
   - åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ `count = 0`ã€‚
3. **æ‰§è¡Œ BFS**ï¼š
   - å½“é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶ï¼š
     - å‡ºé˜Ÿä¸€ä¸ªèŠ‚ç‚¹ `u`ã€‚
     - `count++`ï¼ˆæ ¸å¿ƒï¼è®°å½•å·²â€œå‰¥æ‰â€çš„èŠ‚ç‚¹æ•°ï¼‰ã€‚
     - éå† `u` çš„æ‰€æœ‰é‚»å±… `v`ï¼š
       - `in_degree[v]--`ï¼ˆæ¨¡æ‹Ÿåˆ é™¤è¾¹ `u -> v`ï¼‰ã€‚
       - å¦‚æœ `in_degree[v] == 0`ï¼Œå°† `v` å…¥é˜Ÿã€‚
4. **åˆ¤æ–­ç»“æœ**ï¼š
   - `return count == n;` (å¦‚æœ `count == n` åˆ™æ— ç¯ï¼Œå¦åˆ™æœ‰ç¯)ã€‚

### ä»£ç å®ç° (LeetCode 207 é£æ ¼)

```
#include <vector>
#include <queue>

using namespace std;

/**
 * @brief ä½¿ç”¨ BFS (Kahn ç®—æ³•) æ£€æµ‹æœ‰å‘å›¾æ˜¯å¦æœ‰ç¯
 * @param numCourses èŠ‚ç‚¹æ€»æ•° n
 * @param prerequisites è¾¹
 * @return true è¡¨ç¤ºæ— ç¯ï¼Œfalse è¡¨ç¤ºæœ‰ç¯
 */
bool canFinish_BFS(int numCourses, vector<vector<int>>& prerequisites) {
    // adj: é‚»æ¥è¡¨
    vector<vector<int>> adj(numCourses);
    // in_degree: å…¥åº¦æ•°ç»„
    vector<int> in_degree(numCourses, 0);

    // 1. å»ºå›¾å¹¶è®¡ç®—å…¥åº¦
    for (const auto& edge : prerequisites) {
        int a = edge[0]; // è¯¾ç¨‹
        int b = edge[1]; // å…ˆä¿®è¯¾ (b -> a)
        adj[b].push_back(a);
        in_degree[a]++;
    }

    // 2. å‡†å¤‡ BFS
    queue<int> q;
    for (int i = 0; i < numCourses; i++) {
        if (in_degree[i] == 0) {
            q.push(i); // å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„èŠ‚ç‚¹å…¥é˜Ÿ
        }
    }

    int count = 0; // è®°å½•å·²å®Œæˆçš„è¯¾ç¨‹æ•°ï¼ˆå³æ‹“æ‰‘æ’åºçš„èŠ‚ç‚¹æ•°ï¼‰

    // 3. æ‰§è¡Œ BFS (æ‹“æ‰‘æ’åº)
    while (!q.empty()) {
        int u = q.front();
        q.pop();
        count++; // èŠ‚ç‚¹ u å·²â€œä¿®å®Œâ€

        for (int v : adj[u]) {
            in_degree[v]--; // è¯¾ç¨‹ v çš„ä¸€é—¨å…ˆä¿®è¯¾ u å·²å®Œæˆ
            if (in_degree[v] == 0) {
                // v çš„æ‰€æœ‰å…ˆä¿®è¯¾éƒ½å·²å®Œæˆï¼Œv å…¥é˜Ÿ
                q.push(v);
            }
        }
    }

    // 4. åˆ¤æ–­ç»“æœ
    // å¦‚æœ count == numCoursesï¼Œè¯´æ˜æ‰€æœ‰è¯¾éƒ½ä¿®å®Œäº†ï¼ˆæ— ç¯ï¼‰
    // å¦åˆ™ï¼Œè¯´æ˜æœ‰ç¯ï¼ˆKahn ç®—æ³•å¤±è´¥ï¼‰
    return count == numCourses;
}
```

## 2. ğŸ¥ˆ æ–¹æ³•äºŒï¼šDFS ä¸ä¸‰è‰²æ ‡è®°æ³•

DFS åˆ¤ç¯æ˜¯**ä¸»åŠ¨å‡ºå‡»**ï¼Œå®ƒé€šè¿‡æ·±åº¦éå†æ¥**ä¸»åŠ¨å¯»æ‰¾â€œåå‘è¾¹ (Back Edge)â€**ã€‚

### æ ¸å¿ƒæ€æƒ³

- æˆ‘ä»¬å¿…é¡»åŒºåˆ†â€œå·²è®¿é—®è¿‡â€çš„ä¸¤ç§çŠ¶æ€ï¼Œå³ä½ ä¹‹å‰é—®çš„ `visit=2` çš„å«ä¹‰ï¼š
  1. **â€œæ­£åœ¨è®¿é—®â€**ï¼šè¯¥èŠ‚ç‚¹åœ¨**å½“å‰çš„é€’å½’è°ƒç”¨æ ˆ**ä¸Šï¼ˆå®ƒæ˜¯å½“å‰èŠ‚ç‚¹çš„ç¥–å…ˆï¼‰ã€‚
  2. **â€œå·²è®¿é—®å®Œæ¯•â€**ï¼šè¯¥èŠ‚ç‚¹åŠå…¶æ‰€æœ‰å­å­™éƒ½å·²è¢«å®‰å…¨æ¢ç´¢å®Œï¼ˆå®ƒä¸æ˜¯å½“å‰èŠ‚ç‚¹çš„ç¥–å…ˆï¼‰ã€‚
- **ä¸‰è‰²æ ‡è®° (Three-Color Mark)**ï¼š
  - `visit[i] = 0` (**ç™½è‰²**): èŠ‚ç‚¹ `i` ä»æœªè¢«è®¿é—®ã€‚
  - `visit[i] = 1` (**ç°è‰²**): èŠ‚ç‚¹ `i` **æ­£åœ¨è¢«è®¿é—®**ï¼ˆ`dfs(i)` å·²è°ƒç”¨ï¼Œä½†æœªè¿”å›ï¼‰ã€‚
  - `visit[i] = 2` (**é»‘è‰²**): èŠ‚ç‚¹ `i` åŠå…¶æ‰€æœ‰å­æ ‘**å·²è®¿é—®å®Œæ¯•**ï¼ˆ`dfs(i)` å·²è¿”å›ï¼‰ã€‚
- **åˆ¤ç¯åŸç†**ï¼š
  - åœ¨ DFS è¿‡ç¨‹ä¸­ï¼Œä» `u` éå†åˆ°é‚»å±… `v`ï¼š
    - å¦‚æœ `v` æ˜¯**ç™½è‰²** (`0`)ï¼šæ­£å¸¸ï¼Œç»§ç»­é€’å½’ `dfs(v)`ã€‚
    - å¦‚æœ `v` æ˜¯**é»‘è‰²** (`2`)ï¼šæ­£å¸¸ï¼Œè¯´æ˜ `v` æ˜¯ä¸€ä¸ªå·²è¢«å¤„ç†å®Œæ¯•çš„å®‰å…¨åˆ†æ”¯ï¼ˆâ€œäº¤å‰è¾¹â€ï¼‰ï¼Œ**å¿½ç•¥**ã€‚
    - å¦‚æœ `v` æ˜¯**ç°è‰²** (`1`)ï¼š**å‘ç°ç¯ï¼** è¿™æ„å‘³ç€ `v` æ˜¯ `u` çš„ä¸€ä¸ªç¥–å…ˆï¼ˆå®ƒåœ¨é€’å½’æ ˆä¸Šï¼‰ï¼Œä½†æˆ‘ä»¬åˆæ‰¾åˆ°äº†ä¸€æ¡ä» `u` æŒ‡å‘ `v` çš„â€œåå‘è¾¹â€ã€‚

### ç®—æ³•æ­¥éª¤

1. **åˆå§‹åŒ–**ï¼š
   - åˆ›å»ºé‚»æ¥è¡¨ `adj`ã€‚
   - åˆ›å»ºçŠ¶æ€æ•°ç»„ `visit[n]`ï¼Œå…¨éƒ¨åˆå§‹åŒ–ä¸º `0` (ç™½è‰²)ã€‚
2. **ä¸»å¾ªç¯**ï¼š
   - éå†æ‰€æœ‰èŠ‚ç‚¹ `i` (ä» 0 åˆ° `n-1`)ï¼š
     - å¦‚æœ `visit[i] == 0` (ç™½è‰²)ï¼Œåˆ™è°ƒç”¨ `dfs(i)`ã€‚
     - å¦‚æœ `dfs(i)` è¿”å› `true` (è¡¨ç¤ºå‘ç°äº†ç¯)ï¼Œåˆ™ç«‹å³è¿”å› `false` (è¡¨ç¤ºâ€œä¸èƒ½å®Œæˆâ€)ã€‚
3. **`dfs(u)` é€’å½’å‡½æ•°**ï¼š
   - `visit[u] = 1` (æ ‡è®° `u` ä¸ºç°è‰²)ã€‚
   - éå† `u` çš„æ‰€æœ‰é‚»å±… `v`ï¼š
     - `if (visit[v] == 0)`ï¼š
       - `if (dfs(v)) return true;` (å¦‚æœå­è°ƒç”¨å‘ç°ç¯ï¼Œä¸€è·¯è¿”å› `true`)ã€‚
     - `else if (visit[v] == 1)`ï¼š
       - `return true;` (å‘ç°ç°è‰²èŠ‚ç‚¹ï¼Œæ‰¾åˆ°ç¯ï¼)ã€‚
     - `else if (visit[v] == 2)`ï¼š
       - (å¿½ç•¥ï¼Œç»§ç»­çœ‹ä¸‹ä¸€ä¸ªé‚»å±…)ã€‚
   - `visit[u] = 2` (æ ‡è®° `u` ä¸ºé»‘è‰²ï¼Œå®‰å…¨å¤„ç†å®Œæ¯•)ã€‚
   - `return false;` (`u` èŠ‚ç‚¹è¿™æ¡åˆ†æ”¯å®‰å…¨)ã€‚
4. **åˆ¤æ–­ç»“æœ**ï¼š
   - å¦‚æœä¸»å¾ªç¯æ­£å¸¸ç»“æŸï¼Œè¿”å› `true` (è¡¨ç¤ºâ€œå¯ä»¥å®Œæˆâ€)ã€‚

### ä»£ç å®ç° (LeetCode 207 é£æ ¼)

```
#include <vector>

using namespace std;

class Solution_DFS {
    // é‚»æ¥è¡¨
    vector<vector<int>> adj;
    // çŠ¶æ€æ ‡è®°æ•°ç»„
    // 0 = æœªè®¿é—® (ç™½è‰²)
    // 1 = æ­£åœ¨è®¿é—® (ç°è‰²)
    // 2 = å·²è®¿é—®å®Œæ¯• (é»‘è‰²)
    vector<int> visit;

    /**
     * @brief æ·±åº¦ä¼˜å…ˆæœç´¢
     * @param u å½“å‰è®¿é—®çš„èŠ‚ç‚¹ (è¯¾ç¨‹)
     * @return true è¡¨ç¤ºåœ¨å½“å‰åˆ†æ”¯â€œå‘ç°äº†ç¯â€ï¼Œfalse è¡¨ç¤ºâ€œæœªå‘ç°ç¯â€
     */
    bool dfs(int u) {
        // 1. æ ‡è®°ä¸ºâ€œæ­£åœ¨è®¿é—®â€ï¼ˆç°è‰²ï¼‰
        visit[u] = 1;

        // éå† u çš„æ‰€æœ‰é‚»å±… v (u æ˜¯ v çš„å…ˆä¿®è¯¾)
        for (int v : adj[u]) {
            if (visit[v] == 0) {
                // Case 1: v æ˜¯â€œç™½è‰²â€ï¼Œç»§ç»­æ·±æœ
                if (dfs(v)) {
                    // å¦‚æœ v çš„å­æ ‘ä¸­å‘ç°äº†ç¯ï¼Œç«‹å³è¿”å› true
                    return true;
                }
            } else if (visit[v] == 1) {
                // Case 2: v æ˜¯â€œç°è‰²â€ï¼
                // v æ­£åœ¨è¢«è®¿é—®ï¼Œè¯´æ˜ v æ˜¯ u çš„ç¥–å…ˆï¼ˆåœ¨é€’å½’æ ˆä¸Šï¼‰
                // æ‰¾åˆ°äº†ä¸€æ¡ u -> v çš„åå‘è¾¹ï¼Œæ„æˆäº†ç¯ã€‚
                return true;
            }
            // Case 3: visit[v] == 2 (é»‘è‰²)
            // v å·²ç»è®¿é—®å®Œæ¯•ï¼Œæ˜¯å®‰å…¨çš„ï¼Œå¿½ç•¥å³å¯ã€‚
        }

        // 3. u çš„æ‰€æœ‰é‚»å±…éƒ½å·²å¤„ç†å®Œæ¯•ï¼Œæ ‡è®°ä¸ºâ€œå·²è®¿é—®â€ï¼ˆé»‘è‰²ï¼‰
        visit[u] = 2;
        // 4. åœ¨ u çš„è¿™ä¸ªåˆ†æ”¯ä¸­æ²¡æœ‰å‘ç°ç¯
        return false;
    }

public:
    // LeetCode 207. è¯¾ç¨‹è¡¨
    bool canFinish(int numCourses, vector<vector<int>>& prerequisites) {
        // 1. åˆå§‹åŒ–
        adj.resize(numCourses);
        visit.resize(numCourses, 0); // åˆå§‹æ—¶æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯â€œç™½è‰²â€

        // 2. å»ºå›¾ (b -> a)
        for (const auto& edge : prerequisites) {
            adj[edge[1]].push_back(edge[0]);
        }

        // 3. éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½œä¸º DFS çš„èµ·ç‚¹ (é˜²æ­¢å›¾ä¸è¿é€š)
        for (int i = 0; i < numCourses; i++) {
            if (visit[i] == 0) {
                // åªæœ‰â€œç™½è‰²â€èŠ‚ç‚¹æ‰éœ€è¦å¯åŠ¨æ–°çš„ DFS
                if (dfs(i)) {
                    // dfs(i) è¿”å› trueï¼Œè¯´æ˜â€œå‘ç°äº†ç¯â€
                    // æ—¢ç„¶æœ‰ç¯ï¼Œå°±â€œä¸èƒ½å®Œæˆâ€
                    return false;
                }
            }
        }

        // 4. æ‰€æœ‰èŠ‚ç‚¹éƒ½éå†å®Œæ¯•ï¼Œæ²¡æœ‰å‘ç°ç¯
        // è¯´æ˜â€œå¯ä»¥å®Œæˆâ€
        return true;
    }
};
```

### 3. æ€»ç»“ä¸å¯¹æ¯”

| ç‰¹æ€§           | BFS (Kahn ç®—æ³•)                     | DFS (ä¸‰è‰²æ ‡è®°æ³•)                       |
| -------------- | ----------------------------------- | -------------------------------------- |
| **æ ¸å¿ƒåŸç†**   | ç»Ÿè®¡å…¥é˜ŸèŠ‚ç‚¹æ€»æ•°æ˜¯å¦ç­‰äº `n`        | æ£€æµ‹æ˜¯å¦å­˜åœ¨æŒ‡å‘â€œç°è‰²â€èŠ‚ç‚¹çš„**åå‘è¾¹** |
| **æ•°æ®ç»“æ„**   | é˜Ÿåˆ— (Queue)ã€å…¥åº¦æ•°ç»„ `in_degree`  | é€’å½’æ ˆ (éšå¼)ã€çŠ¶æ€æ•°ç»„ `visit` (3æ€)  |
| **åˆ¤ç¯æ–¹å¼**   | **é—´æ¥**ï¼š`count < n`               | **ç›´æ¥**ï¼š`visit[v] == 1`              |
| **ä¸»è¦å¼€é”€**   | è®¡ç®—æ‰€æœ‰èŠ‚ç‚¹çš„å…¥åº¦ (O(E))           | é€’å½’æ ˆæ·±åº¦ (æœ€å O(V))                 |
| **æ—¶é—´å¤æ‚åº¦** | O(V + E)                            | O(V + E)                               |
| **ç©ºé—´å¤æ‚åº¦** | O(V + E)                            | O(V + E)                               |
| **é¢å¤–äº§å‡º**   | æ‹“æ‰‘æ’åºåºåˆ—ï¼ˆé˜Ÿåˆ— `q` çš„å‡ºé˜Ÿé¡ºåºï¼‰ | (æ— ï¼Œä½†å¯ä¿®æ”¹ä»¥äº§ç”Ÿæ‹“æ‰‘æ’åºçš„é€†åº)     |